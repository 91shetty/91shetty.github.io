<!DOCTYPE html>
<html lang = "en">
	<head>
		<title> Branch History for Main_new</title>
		<script type="text/javascript" src="d3/d3.js"></script>
	</head>
	<body>
		<script type="text/javascript">
			var margin = {top: 20, right: 100, bottom: 20, left: 100},
				    width = 1400 - margin.right - margin.left,
				    height = 800 - margin.top - margin.bottom;

			var parseDate = d3.time.format("%x").parse;
			var x = d3.time.scale()
    				.range([0, width]);
    		var root;
    		var i = 0,
    			j = 0,
    			total = 1,
    			offset = height/2;

    		var branchData = {
	"name" : "main_new",
	"date" : "26/11/2013",
	"desc" : "main line",
	"dev" : "mahesh",
	"active" : "yes",
	"branches" : [
		
		{
			"name" : "ShareConnect_VS2012",
			"date" : "26/5/2014",
			"desc" : "VS2012 Migration",
			"dev" : "sumit",
			"active" : "no"
		},
		{
			"name" : "ShareConnect_VPN",
			"date" : "10/06/2014",
			"desc" : "vpn",
			"dev" : "sumit",
			"active" : "yes"
		},
		{
			"name" : "WorxDesktop",
			"date" : "11/06/2014",
			"desc" : "Exe name changes for Worx",
			"dev" : "sumit",
			"active" : "no"
		},
		{
			"name" : "wd_enable_dc",
			"date" : "8/07/2014",
			"desc" : "Enable direct connection",
			"dev" : "rakesh kumar",
			"active" : "yes"
		},
		{
			"name" : "worx_desktop_dc",
			"date" : "14/07/2014",
			"desc" : "Direct channel support",
			"dev" : "rakesh kumar",
			"active" : "yes"
		},
		{
			"name" : "main_sc_ux",
			"date" : "22/07/2014",
			"desc" : "ux refresh",
			"dev" : "mahesh",
			"active" : "yes"
		}
	]
};

    		var branchName = function(d){
    			console.log(d.name);
    			return d.name;
    		}
    		var date = function(d){
    			return parseDate(d.date);
    		}
    		var devsWorking = function(d){
    			return d.dev;
    		}
    		var branchDesc = function(d){
    			return d.desc;
    		}
    		var branchStatus = function(d){
    			console.log(d.active);
    			return d.active;
    		}

			var svg = d3.select("body").append("svg")
				    .attr("width", width + margin.right + margin.left)
				    .attr("height", height + margin.top + margin.bottom)
				    .append("g")
			    	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			//d3.json("branch_data.json", function(error, branchData) {
				for (k in branchData) {
        			var k_data = branchData[k];
					drawMainBranch(k_data);
				 	k_data.forEach(function(d){
				 		console.log(d.active);
				 		console.log(d.desc);
				// 	svg.append("path")
				// 	.attr("d",function(d){
				//    		if(d.active == "yes"){
				//    			console.log(branchStatus);
				//    			i++;
				//    			offset -= (margin.left * i);
				//    		}
				//    		else if(d.active == "no"){
				//    			console.log(branchStatus);
				//    			j++;
				//    			offset += (margin.left * j);
				//    		}
				//    		console.log(branchStatus);
				//    		total++;
				//    		return "M" + (margin.left * total) + "," + (height/2) + "L" + (margin.left * total) + "," + offset + "L" + width + "," + offset;

				//    })
				//    .attr("stroke","green")
				//    .attr("stroke-width","2")
				//    .attr("fill","none")
				//    .attr("stroke-dasharray","7.51 7.51")
				//    .attr("marker-end","url(#triangle)");
				 	});
				}
			//});

			svg.append("marker")
			   .attr("id","triangle")
			   .attr("viewBox","0 0 10 10")
			   .attr("refX","0")
			   .attr("refY","5")
			   .attr("markerWidth","4")
			   .attr("markerHeight","3")
			   .attr("orient","auto")
			   .append("path")
			   .attr("d","M0,0L10,5L0,10");

			function drawMainBranch(d){
				svg.append("line")
				   .attr("x1",margin.left)
				   .attr("y1",height/2)
				   .attr("x2",width)
				   .attr("y2",height/2)
				   .attr("stroke","green")
				   .attr("stroke-width","2")
				   .attr("stroke-dasharray","7.51 7.51")
				   .attr("marker-end","url(#triangle)");	
			}

			function drawBranch(d){
				svg.append("path")
				   // .attr("x1",function(d){
				   // 		total++;
				   // 		return margin.left * total;
				   // })
				   // .attr("y1",height/2)
				   // .attr("x2",margin.left * total)
				   // .attr("y2",function(d){
				   // 	if(d.active == "yes"){
				   // 		i++;
				   // 		return 

				   // 	}
				   // })
				   // .attr("")
				   .attr("d",function(d){
				   		if(branchStatus == "yes"){
				   			console.log(branchStatus);
				   			i++;
				   			offset -= (margin.left * i);
				   		}
				   		else if(branchStatus == "no"){
				   			console.log(branchStatus);
				   			j++;
				   			offset += (margin.left * j);
				   		}
				   		console.log(branchStatus);
				   		total++;
				   		return "M" + (margin.left * total) + "," + (height/2) + "L" + (margin.left * total) + "," + offset + "L" + width + "," + offset;

				   })
				   .attr("stroke","green")
				   .attr("stroke-width","2")
				   .attr("fill","none")
				   .attr("stroke-dasharray","7.51 7.51")
				   .attr("marker-end","url(#triangle)");
			}

		</script>
	</body>
</html>